name: modul8

on:
  push:
    paths:
      - 'github furuvegen/iac/iac-1/modul8github/**'
  pull_request:
    branches:
      - main

      env:
 ARM_CLIENT_ID: ${{ secrets.AZURE_CLIENT_ID }}
 ARM_CLIENT_SECRET: ${{ secrets.AZURE_CLIENT_SECRET }}
 ARM_SUBSCRIPTION_ID: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
 ARM_TENANT_ID: ${{ secrets.AZURE_TENANT_ID }}
 WORKING_DIR: ./github furuvegen/iac/iac-1/modul8github


jobs:
 terraform:
 name: 'Terraform'
 runs-on: ubuntu-latest
 steps:
 - name: Checkout
 uses: actions/checkout@v2
 - name: Setup Terraform
 uses: hashicorp/setup-terraform@v1
 - name: Terraform Init
 run: terraform init
 - name: Terraform Format
 run: terraform fmt -check
 - name: Terraform Plan
 run: terraform plan -out=tfplan
 
 - name: Publish Terraform Plan
 uses: actions/upload-artifact@v2
 with:
 name: tfplan
 path: tfplan
 - name: Terraform Apply
 if: github.ref == 'refs/heads/main' && github.event_name == 'push'
 run: terraform apply -auto-approve tfplan
